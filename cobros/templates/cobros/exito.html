{% load static %}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <title>Pago recibido — IUAF</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      :root{ --card-radius: 16px; }
      body{
        background: radial-gradient(1200px 600px at 80% -20%, #e8f5ff 0%, transparent 60%),
                    radial-gradient(900px 500px at -10% 110%, #f5f9ff 0%, transparent 60%),
                    #f7f8fb;
      }
      .page-wrap{ min-height: 100dvh; display:grid; place-items:center; padding:2rem 1rem; }
      .result-card{ border:1px solid rgba(0,0,0,.06); border-radius:var(--card-radius); box-shadow:0 10px 30px rgb(20 20 40 / 8%); overflow:hidden; }
      .hero{ background:linear-gradient(135deg,#0ea5e9 0%,#3b82f6 60%,#6366f1 100%); color:#fff; padding:2.25rem 2rem 1.25rem; }
      .hero .icon-wrap{ width:64px; height:64px; border-radius:50%; background:rgba(255,255,255,.12); display:flex; align-items:center; justify-content:center; margin-bottom:1rem; }
      .hero .icon-wrap svg{ width:34px; height:34px; }
      .hero small{ opacity:.9 }
      .summary{ padding:1.25rem 1.25rem 1.5rem; background:#fff; }
      .kv{ display:flex; align-items:center; justify-content:space-between; gap:.75rem; padding:.6rem .85rem; border-radius:.75rem; border:1px solid rgba(0,0,0,.06); background:#fff; }
      .kv + .kv{ margin-top:.5rem; }
      .muted{ color:#6b7280; }
      .badge-soft{ background:rgba(2,132,199,.1); color:#0369a1; }
      .badge-paid{ background:rgba(16,185,129,.12); color:#047857; }
      .badge-failed{ background:rgba(239,68,68,.12); color:#b91c1c; }
      .badge-processing{ background:rgba(59,130,246,.12); color:#1d4ed8; }
      .actions{ padding:1rem 1.25rem 1.25rem; background:#fff; border-top:1px solid rgba(0,0,0,.06); display:flex; flex-wrap:wrap; gap:.6rem; justify-content:flex-end; }
      .copy-btn{ border:none; background:transparent; color:#2563eb; font-weight:600; }
      .copy-btn:hover{ text-decoration:underline; color:#1d4ed8; }
      .footer-note{ color:#6b7280; font-size:.92rem; }

      /* Romper y/o limitar a 2 líneas los IDs larguísimos */
      .wrap-id-2lines{
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;   /* <= 2 líneas */
        overflow: hidden;
        white-space: normal;
        word-break: break-all;
        overflow-wrap: anywhere;
        max-width: 380px;        /* ajusta según tu layout */
      }

      @media (prefers-color-scheme: dark){
        body{ background:#0b1220; }
        .result-card{ border-color:rgba(255,255,255,.08); box-shadow:none; }
        .summary, .actions{ background:#0f172a; border-color:rgba(255,255,255,.08); }
        .kv{ background:#0b1220; border-color:rgba(255,255,255,.08); color:#cbd5e1; }
        .muted, .footer-note{ color:#94a3b8; }
        .copy-btn{ color:#60a5fa; }
      }
    </style>
  </head>
  <body>
    <div class="page-wrap">
      <div class="container" style="max-width: 820px;">
        <div class="result-card">
          <!-- Encabezado -->
          <div class="hero">
            <div class="icon-wrap">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 12l2 2 4-4M20.28 7.28a9 9 0 11-12.56 0 9 9 0 0112.56 0z"/>
              </svg>
            </div>
            <h1 class="h3 m-0">¡Gracias!</h1>
            {% with st=status|default:"processing"|lower %}
              <small>
                Tu operación fue recibida{% if st == "paid" %} y confirmada{% endif %}.
              </small>
            {% endwith %}
          </div>

          <!-- Resumen -->
          <div class="summary">
            <div class="row g-3">
              <div class="col-md-7">
                <div class="kv">
                  <span class="muted">Referencia de sesión</span>
                  <div class="text-end">
                    <code id="ref"
                          class="wrap-id-2lines"
                          title="{{ session_id }}"
                          data-full="{{ session_id }}">{{ session_id }}</code>
                    <button class="copy-btn ms-1" type="button" data-copy="#ref">Copiar</button>
                  </div>
                </div>

                {% if amount %}
                <div class="kv">
                  <span class="muted">Monto</span>
                  <strong>$ {{ amount }} {{ currency|default:"MXN" }}</strong>
                </div>
                {% endif %}

                <div class="kv">
                  <span class="muted">Modo</span>
                  {% with m=mode|default:"payment"|lower %}
                    <span class="badge badge-soft rounded-pill">
                      {% if m == "payment" %}Pago único{% elif m == "subscription" %}Suscripción{% else %}{{ m|title }}{% endif %}
                    </span>
                  {% endwith %}
                </div>

                <div class="kv">
                  <span class="muted">Estado reportado por Stripe</span>
                  {% with st=status|default:"processing"|lower %}
                    {% if st == "paid" %}
                      <span class="badge rounded-pill badge-paid">Pagado</span>
                    {% elif st == "unpaid" or st == "failed" %}
                      <span class="badge rounded-pill badge-failed">No pagado</span>
                    {% elif st == "no_payment_required" %}
                      <span class="badge rounded-pill badge-processing">Sin pago requerido</span>
                    {% else %}
                      <span class="badge rounded-pill badge-processing">Procesando</span>
                    {% endif %}
                  {% endwith %}
                </div>
              </div>

              <div class="col-md-5">
                <div class="h-100 d-flex flex-column justify-content-between">
                  <div class="footer-note">
                    En breve verás el reflejo en tu estado de cuenta.
                    Si ya cerraste esta ventana, conserva la referencia por cualquier aclaración.
                  </div>
                  <div class="mt-3 small text-muted">
                    Soporte: <a href="mailto:finanzas@iuaf.edu.mx">finanzas@iuaf.edu.mx</a>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Acciones -->
          <div class="actions">
            <a href="https://www.iuaf.edu.mx/" class="btn btn-outline-secondary">Ir al inicio</a>
            {% url 'panel_home' as campus_url %}
            {% if campus_url %}
              <a href="{{ campus_url }}" class="btn btn-primary">Ir a mi campus</a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Copiar referencia (usa el valor completo, aunque se muestre cortado)
      document.addEventListener('click', async (e)=>{
        const btn = e.target.closest('[data-copy]');
        if(!btn) return;
        const sel = btn.getAttribute('data-copy');
        const el = document.querySelector(sel);
        if(!el) return;
        try{
          const full = el.getAttribute('data-full') || el.textContent;
          await navigator.clipboard.writeText(full.trim());
          const original = btn.textContent;
          btn.textContent = 'Copiado ✓';
          setTimeout(()=> btn.textContent = original, 1600);
        }catch(_){}
      });
    </script>
  </body>
</html>
